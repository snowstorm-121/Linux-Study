> ### å†™åœ¨å‰é¢ï¼š
> 
> æˆ‘çš„Linuxçš„å­¦ä¹ ä¹‹è·¯éå¸¸åå·ã€‚ç¬¬ä¸€æ¬¡å­¦ä¹ Linuxæ˜¯åœ¨å¤§ä¸€ä¸‹çš„å¼€å­¦æ²¡å¤šä¹…ï¼Œç»“æœå› ä¸ºä¸ä¼šå®‰è£…VMwareå°±æ— ç–¾è€Œç»ˆäº†ï¼Œå¯ä»¥è¯´æ˜¯æ²¡å¼€å§‹å°±å¤±è´¥äº†ã€‚ç¬¬äºŒæ¬¡å­¦ä¹ Linuxæ˜¯åœ¨å¤§ä¸€ä¸‹å¿«æ”¾æš‘å‡ï¼ˆé‚£ä¸ªæ—¶å€™åˆšåˆšè¿‡å®Œè€ƒè¯•å‘¨ï¼‰ï¼Œæˆ‘æ²¡ä»€ä¹ˆäº‹åšå°±åˆé‡æ‹¾Linuxï¼Œä¸æœè¾“çš„æˆ‘é€‰æ‹©å†æˆ˜Linuxï¼Œè¿™ä¸€æ¬¡å­¦ä¹ è¿˜ç®—é¡ºåˆ©ï¼Œè™½ç„¶ä¸­é—´æœ‰äº›å°æ’æ›²ä½†æ˜¯ä¸å½±å“æ•´ä½“å­¦ä¹ è¿›åº¦ï¼Œ æˆ‘çœ‹ç€Bç«™ä¸Šçš„è§†é¢‘ä¸€ç‚¹ç‚¹å­¦ä¹ Linuxï¼ŒåŸºæœ¬ä¸ŠæŠŠLinuxçš„åŸºç¡€æŒ‡ä»¤å­¦å®Œäº†ã€‚å­¦å®Œä¹‹åæˆ‘åˆé‡åˆ°é—®é¢˜äº†ï¼Œè§†é¢‘åŸºæœ¬ä¸Šåˆ°è¿™å°±ç»“æŸäº†ï¼Œè€Œæˆ‘å´ä¸çŸ¥é“ä¸‹ä¸€æ­¥è¯¥å­¦ä»€ä¹ˆï¼Œäºæ˜¯å°±æ²¡æ€ä¹ˆç¢°Linuxï¼Œç»“æœæ²¡è¿‡å¤šé•¿æ—¶é—´æˆ‘å°±æŠŠå­¦çš„LinuxæŒ‡ä»¤å¿˜çš„ä¸€å¹²äºŒå‡€ã€‚ç°åœ¨æ˜¯æˆ‘ç¬¬ä¸‰æ¬¡å­¦ä¹ Linuxï¼Œæˆ‘å†³å®šé‡æ–°å¼€å§‹å­¦Linuxï¼ŒåŒæ—¶ä¸ºäº†è®©è‡ªå·±å­¦ä¹ çš„æ•ˆæœæ›´å¥½ï¼Œæˆ‘é€‰æ‹©ä»¥å†™blogçš„å½¢å¼é€¼è¿«è‡ªå·±æ¯å¤©æŠŠå­¦ä¹ åˆ°çš„LinuxçŸ¥è¯†æ•´ç†ä¸‹æ¥ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘å†™è¿™ä¸ªç³»åˆ—blogçš„åŸå› ã€‚

---

## è¿›ç¨‹é—´é€šä¿¡

 ![1](https://img-blog.csdnimg.cn/direct/604d8ca8d34041a78a4ca08e4511a30a.png#pic_center) IPCï¼ˆInterprocess Communication)è¿›ç¨‹é—´é€šä¿¡
è¿›ç¨‹é—´é€šä¿¡çš„å¸¸ç”¨æ–¹å¼ï¼Œç‰¹å¾ï¼š

- ç®¡é“ï¼šç®€å•
- ä¿¡å·ï¼šå¼€é”€å°
- mmapæ˜ å°„ï¼šéè¡€ç¼˜å…³ç³»è¿›ç¨‹é€šä¿¡
- socketï¼ˆæœ¬åœ°å¥—æ¥å­—ï¼‰ï¼šç¨³å®š

---

## ç®¡é“(pipe)é€šä¿¡

### å®ç°åŸç†ï¼šå†…æ ¸å€ŸåŠ©ç¯å½¢é˜Ÿåˆ—æœºåˆ¶ï¼Œä½¿ç”¨å†…æ ¸ç¼“å†²åŒºå®ç°ã€‚

### ç‰¹è´¨ï¼š

- ä¼ªæ–‡ä»¶
- ç®¡é“ä¸­çš„æ•°æ®åªèƒ½ä¸€æ¬¡è¯»å–
- æ•°æ®åœ¨ç®¡é“ä¸­åªèƒ½å•å‘æµåŠ¨

### å±€é™æ€§ï¼š

- è‡ªå·±å†™ï¼Œä¸èƒ½è‡ªå·±è¯»ã€‚
- æ•°æ®ä¸èƒ½åå¤è¯»å–ã€‚
- åŠåŒå·¥é€šä¿¡
- ä»…é™äºè¡€ç¼˜å…³ç³»è¿›ç¨‹ä½¿ç”¨

### åŸºæœ¬ç”¨æ³•

`pipe()`å‡½æ•°ï¼Œåˆ›å»ºå¹¶æ‰“å¼€ç®¡é“ã€‚
`int pipe(int fd[2]);`
å‚æ•°ï¼š

- `fd[0]`:è¯»ç«¯
- `fd[1]`: å†™ç«¯

è¿”å›å€¼ï¼š

- æˆåŠŸï¼Œ0
- å¤±è´¥ï¼Œ-1ï¼Œ`errno`è¢«è®¾ç½®

ç®¡é“é€šä¿¡åŸç†ï¼ˆå›¾)ï¼š
![1](https://img-blog.csdnimg.cn/direct/5fe98fe878994c89acd018dfefb44953.png#pic_center)

### ä¸¾ä¸ªæ —å­

æºä»£ç ï¼š

```c
#include<stdio.h>
#include<unistd.h>
#include<string.h>

int main()
{
    int fd[2];
    char p[30]="This a test about pipe\n";
    char buf[30];
    pid_t pid;
    pipe(fd);
    pid=fork();
    if(pid==0)
    {
        close(fd[1]);
        read(fd[0],buf,sizeof buf);
        printf("%s",buf);
    }
    else 
    {
        close(fd[0]);
        printf("I am parent,i will write something to mychild\n");
        write(fd[1],p,strlen(p));
    }
    return 0;
}
```

æ•ˆæœï¼š
![2](https://img-blog.csdnimg.cn/direct/903d2e9f5e3640c9a66479e756af85a6.png#pic_center)

### ç®¡é“çš„è¯»å†™è¡Œä¸º

- è¯»ç®¡é“
  - ç®¡é“æœ‰æ•°æ®ï¼Œ`read`è¯»å–æ•°æ®ï¼Œè¿”å›å®é™…è¯»åˆ°çš„å­—èŠ‚æ•°ã€‚
  - ç®¡é“æ²¡æœ‰æ•°æ®ï¼š
    - æ²¡æœ‰å†™ç«¯ï¼Œ`read`è¿”å›0ï¼ˆç±»ä¼¼è¯»åˆ°æ–‡ä»¶çš„æœ«å°¾ï¼‰
    - æœ‰å†™ç«¯ï¼Œ`read`é˜»å¡ç­‰å¾…ã€‚
- å†™ç®¡é“
  - æ²¡æœ‰è¯»ç«¯ï¼Œå¼‚å¸¸ç»ˆæ­¢ã€‚
  - æœ‰è¯»ç«¯ï¼š
    - ç®¡é“æœªæ»¡ï¼Œå¾€ç®¡é“é‡Œå†™æ•°æ®ï¼Œè¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°ã€‚
    - ç®¡é“å·²æ»¡ï¼Œé˜»å¡ç­‰å¾…ã€‚

### ç»¼åˆç»ƒä¹ 

æˆ‘ä»¬ä½¿ç”¨ç®¡é“é€šä¿¡å®ç°çˆ¶å­è¿›ç¨‹`ls | wc -l`åŠŸèƒ½
æ€è·¯åˆ†æï¼š

1. æˆ‘ä»¬å…ˆè®©çˆ¶è¿›ç¨‹å†™ï¼Œå­è¿›ç¨‹è¯»ï¼ˆçˆ¶è¿›ç¨‹è¯»ï¼Œå­è¿›ç¨‹å†™ä¹Ÿå¯ä»¥ï¼‰
2. å¯¹äºçˆ¶è¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¹‹å‰å­¦çš„å‡½æ•°`execlp`ï¼Œä½†æ˜¯`ls`å‘½ä»¤è¾“å‡ºåˆ°å±å¹• ï¼Œæˆ‘ä»¬åˆæƒ³åˆ°ä¹‹å‰å­¦çš„å‡½æ•°`dup2`é‡å®šå‘ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ`STDOUT_FILENO`é‡å®šå‘åˆ°ç®¡é“çš„å†™ç«¯ã€‚
3. å¯¹äºå­è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¹‹å‰å­¦çš„å‡½æ•°`execlp`,ä½†æ˜¯`wc`æ¥å—çš„å‘½ä»¤æ˜¯æ¥è‡ªå±å¹•ï¼Œæˆ‘ä»¬åˆæƒ³åˆ°ä¹‹å‰çš„å­¦çš„å‡½æ•°`duo2`é‡å®šå‘ï¼ŒæŠŠ`STDIN_FILENO`é‡å®šå‘åˆ°ç®¡é“çš„è¯»ç«¯ã€‚

æºä»£ç ï¼š

```c
#include<stdio.h>
#include<unistd.h>

int main()
{
        int fd[2];
        pipe(fd);
        pid_t pid;
        pid= fork();
        if(pid==0)
        {
                close(fd[0]);
                dup2(fd[1],STDOUT_FILENO);
                execlp("ls","ls",NULL);
                perror("child error");
        }
        else
        {
                close(fd[1]);
                dup2(fd[0],STDIN_FILENO);
                execlp("wc","wc","-l",NULL);
                perror("parent error");
        }
        return 0;
}
```

æ•ˆæœï¼š
![3](https://img-blog.csdnimg.cn/direct/556cc2c2101944a3839596d9e788e780.png#pic_center)

### å…„å¼Ÿé—´é€šä¿¡

 æˆ‘ä»¬ç”¨ä¸€ä¸ªçˆ¶è¿›ç¨‹åˆ›å»ºä¸¤ä¸ªå­è¿›ç¨‹ï¼Œç”¨è¿™ä¸¤ä¸ªå­è¿›ç¨‹æ¥å®ç°ä¸Šé¢çš„åŠŸèƒ½`ls | wc -l`
 æºä»£ç ï¼š

```c
#include<stdio.h>
#include<unistd.h>

int main()
{
    int fd[2],i;
    pipe(fd);
    for(i=0;i<2;i++)
    {
        if(fork())
            break;
    }

    if(2==i)
    {
        close(fd[1]);    
        close(fd[0]);
        wait(NULL);
        wait(NULL);
        printf("I am parent,i wait two children successfully\n");
    }
    else if(0==i)
    {
        close(fd[0]);
        dup2(fd[1],STDOUT_FILENO);
        execlp("ls","ls",NULL);
        perror("1th child error");
    }
    else if(1==i)
    {
        close(fd[1]);
        dup2(fd[0],STDIN_FILENO);
        execlp("wc","wc","-l",NULL);
        perror("2th child error");
    }
    return 0;
}
```

æ•ˆæœï¼š
![4](https://img-blog.csdnimg.cn/direct/385705b599b84890afa64e9c0e1a069b.png#pic_center)

> **è¿™é‡Œå”¯ä¸€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬ç”¨å…„å¼Ÿé€šä¿¡æ—¶ï¼Œè¦æŠŠçˆ¶è¿›ç¨‹çš„è¯»ç«¯å’Œå†™ç«¯éƒ½å…³é—­**

> ä¸€ä¸ªpipeå¯ä»¥æœ‰ä¸€ä¸ªå†™ç«¯å¤šä¸ªè¯»ç«¯
> ä¸€ä¸ªpipeå¯ä»¥æœ‰å¤šä¸ªå†™ç«¯ä¸€ä¸ªè¯»ç«¯

> ç®¡é“çš„é»˜è®¤å¤§å°æ˜¯4096ï¼ˆ4k)
> ![5](https://img-blog.csdnimg.cn/direct/de62b99f9ff94d5badcd6a7ed8e86b66.png#pic_center)

---

## å‘½ä»¤ç®¡é“ï¼ˆfifo)é€šä¿¡

### ä¼˜ç®¡é“çš„ä¼˜ç¼ºç‚¹

 ä¼˜ç‚¹ï¼š

- ç®€å•ï¼Œç›¸æ¯”ä¿¡å·ï¼Œå¥—æ¥å­—å®ç°è¿›ç¨‹é€šä¿¡ï¼Œç®€å•å¾ˆå¤š
  ç¼ºç‚¹ï¼š
  - åªèƒ½å•å‘é€šä¿¡ï¼ŒåŒå‘é€šä¿¡éœ€å»ºç«‹ä¸¤ä¸ªç®¡é“
  - åªèƒ½ç”¨äºæœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ã€‚è¯¥é—®é¢˜åæ¥ä½¿ç”¨fifoå‘½åç®¡é“è§£å†³ã€‚

fifoç®¡é“ï¼šå¯ä»¥ç”¨äºæ— è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ã€‚fifoæ“ä½œèµ·æ¥åƒæ–‡ä»¶

### mkfifoå‡½æ•°

![1](https://img-blog.csdnimg.cn/direct/a0d555d3d3f64db893be4b0581958964.png#pic_center)
è¿™ä¸ªå‡½æ•°å’Œ`open`å·®ä¸å¤šï¼Œåªä¸è¿‡åˆ›å»ºçš„æ–‡ä»¶ç±»å‹ä¸åŒç½¢äº†ã€‚
è¿”å›å€¼ï¼š

- æˆåŠŸï¼Œ0
- å¤±è´¥ï¼Œ-1ï¼Œ`errno`è¢«è®¾ç½®

### fifoå®ç°éè¡€ç¼˜å…³ç³»è¿›ç¨‹é—´é€šä¿¡

#### æ€è·¯ï¼š

1. æˆ‘ä»¬æ‰“å¼€ä¸¤ä¸ªæ²¡æœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼Œä¸€ä¸ªè´Ÿè´£å†™ï¼ˆæˆ‘ä»¬å‘½ä»¤ä¸º`fifo_w`ï¼Œä¸€ä¸ªè´Ÿè´£è¯»ï¼ˆæˆ‘ä»¬å‘½ä»¤ä¸º`fifo,r`)ã€‚åŒæ—¶ä½¿ç”¨`mkfifio`åˆ›å»ºä¸€ä¸ªå‘½åç®¡é“ï¼ˆæˆ‘ä»¬å‘½åä¸º`fifo_test`)ã€‚
2. å¯¹äº`fifo_w`ï¼Œæˆ‘ä»¬æ‰“å¼€ç®¡é“çš„å†™ç«¯`fd=open("fifo_test",O_WRONLY)`ï¼Œæ¥ä¸‹æ¥æ“ä½œå’Œæ–‡ä»¶ä¸€æ ·ï¼Œä½¿ç”¨`write`å‘`fifo_test`é‡Œå†™æ•°æ®ã€‚
3. å¯¹äº`fifo_r`ï¼Œæˆ‘ä»¬æ‰“å¼€ç®¡é“çš„è¯»ç«¯`fd=open("fifo_test",O_RDONLY)`ï¼Œæ¥ä¸‹æ¥æ“ä½œå’Œæ–‡ä»¶ä¸€æ ·ï¼Œä½¿ç”¨`read`å‘`fifo_test`é‡Œè¯»æ•°æ®ã€‚

#### å®é™…æ¼”ç¤º

##### æºä»£ç ï¼š

`fifo_w`éƒ¨åˆ†ï¼š

```c
#include<stdio.h>
#include<unistd.h>
#include<string.h>
#include<fcntl.h>

int main()
{
    char p[100]="This is a test about fifo";
    char buf[100];
    int cnt=0;
    int fd=open("fifo_test",O_WRONLY);
    if(fd==-1)
        perror("open file error");
    while(1)
    {
        sprintf(buf,"%s---%d",p,cnt++);
        write(fd,buf,strlen(buf));
        sleep(1);
    }
    return 0;
}
```

`fifo_r`éƒ¨åˆ†ï¼š

```c
#include<stdio.h>
#include<unistd.h>
#include<fcntl.h>
#include<string.h>

int main()
{
    int fd=open("fifo_test",O_RDONLY);
    if(fd==-1)
        perror("open file error");
    while(1)
    {
        int res;
        char buf[100];
        res=read(fd,buf,sizeof buf);
        if(res<0)
            perror("read error");
        printf("%s\n",buf);
        sleep(1);
    }
    return 0;
}
```

##### æ•ˆæœï¼š

![2](https://img-blog.csdnimg.cn/direct/8e45472c790f4503b496c8eba59cce5f.png#pic_center)

---

## æ–‡ä»¶ç”¨äºè¿›ç¨‹é—´é€šä¿¡

### åŸç†ï¼š

æ‰“å¼€çš„æ–‡ä»¶æ˜¯å†…æ ¸ä¸­çš„ä¸€å—ç¼“å†²åŒºã€‚å¤šä¸ªæ— è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼Œå¯ä»¥åŒæ—¶è®¿é—®è¯¥æ–‡ä»¶ã€‚
![1](https://img-blog.csdnimg.cn/direct/adba51c8bf0342c6b9289d471eeb7db1.png#pic_center)

### æ€»ç»“ï¼š

- åªæ˜¯æœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹å¯¹äºåŒä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨çš„åŒä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚
- æ²¡æœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼Œå¯¹åŒä¸€ä¸ªæ–‡ä»¶ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¸åŒã€‚
- è¿™äº›éƒ½ä¸æ˜¯é—®é¢˜ï¼Œæ‰“å¼€çš„æ˜¯åŒä¸€ä¸ªæ–‡ä»¶å°±è¡Œã€‚

---

## mmapå‡½æ•°

### å­˜å‚¨æ˜ å°„I/O(Memory-mapped I/O)

- ä½¿ä¸€ä¸ªç£ç›˜æ–‡ä»¶ä¸å­˜å‚¨ç©ºé—´ä¸­çš„ä¸€ä¸ªç¼“å†²åŒºç›¸æ˜ å°„ã€‚äºæ˜¯ä»ç¼“å†²åŒºä¸­å–æ•°æ®ï¼Œå°±ç›¸å½“äºè¯»æ–‡ä»¶ä¸­çš„ç›¸åº”å­—èŠ‚ã€‚
- ä¸æ­¤ç±»ä¼¼ï¼Œå°†æ•°æ®å­˜å…¥ç¼“å†²åŒºï¼Œåˆ™ç›¸åº”çš„å­—èŠ‚å°±è‡ªåŠ¨å†™å…¥æ–‡ä»¶ã€‚è¿™æ ·ï¼Œå°±å¯åœ¨ä¸ä½¿ç”¨readå’Œwriteå‡½æ•°çš„æƒ…å†µä¸‹ï¼Œä½¿åœ°å€æŒ‡é’ˆå®ŒæˆI/Oæ“ä½œã€‚
- ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œé¦–å…ˆåº”è¯¥é€šçŸ¥å†…æ ¸ï¼Œå°†ä¸€ä¸ªæŒ‡å®šæ–‡ä»¶æ˜ å°„åˆ°å­˜å‚¨åŒºåŸŸä¸­ã€‚è¿™ä¸ªæ˜ å°„å·¥ä½œå¯ä»¥é€šè¿‡mmapå‡½æ•°æ¥å®ç°ã€‚

### å‡½æ•°è§£è¯»

![1](https://img-blog.csdnimg.cn/direct/52f592edbc04480c84d020c39864cad8.png#pic_center)
`void *mmap(void *addr,size_t length,int prot,int flags,int fd,off_t offset`

#### å‚æ•°

- `addr`:æŒ‡å®šæ˜ å°„åŒºçš„é¦–åœ°å€ã€‚é€šå¸¸ä¼ `NULL`ï¼Œè¡¨ç¤ºè®©ç³»ç»Ÿè‡ªåŠ¨åˆ†é…
- `length`:å…±äº«å†…å­˜æ˜ å°„åŒºçš„å¤§å°ã€‚ï¼ˆ`<= `æ–‡ä»¶çš„å®é™…å¤§å°ï¼‰
- `prot`:å…±äº«å†…å­˜æ˜ å°„åŒºçš„è¯»å†™å±æ€§ã€‚
  - `PROT_READ`ï¼šè¯»
  - `PROT_WRITE`ï¼šå†™
  - `PROT_READ|PROT_WRITE`ï¼šè¯»/å†™
- `flags`:æ ‡æ³¨å…±äº«å†…å­˜çš„å…±äº«å±æ€§ã€‚
  - `MAP_SHARED` ä¿®æ”¹ä¼šåæ˜ åˆ°ç£ç›˜ä¸Šã€‚
  - `MAP_PRIVATE` ä¿®æ”¹ä¸åæ˜ åˆ°ç£ç›˜ä¸Šã€‚   
- `fd`:ç”¨äºåˆ›å»ºå…±äº«å†…å­˜æ˜ å°„åŒºçš„é‚£ä¸ªæ–‡ä»¶çš„ æ–‡ä»¶æè¿°ç¬¦ã€‚
- `offset`:é»˜è®¤0ï¼Œè¡¨ç¤ºæ˜ å°„æ–‡ä»¶å…¨éƒ¨ã€‚åç§»ä½ç½®ã€‚éœ€æ˜¯ `4k çš„æ•´æ•°å€`ã€‚

#### è¿”å›å€¼ï¼š

- æˆåŠŸï¼Œæ˜ å°„åŒºçš„é¦–åœ°å€
- å¤±è´¥ï¼Œè¿”å›å®`MAP_FAILED`,å…¶å®å°±æ˜¯`void*`ç±»å‹çš„`0`.

### munmapå‡½æ•°

`int munmap(void *addr, size_t length);`
ä½œç”¨ï¼šé‡Šæ”¾æ˜ å°„åŒº
å‚æ•°ä¼ çš„ä¸€èˆ¬å’Œ`mmap`ä¸€æ ·å³å¯ï¼ˆè¿™æ ·è‚¯å®šä¸ä¼šé”™ï¼‰ã€‚

### ä¸¾ä¸ªæ —å­

æˆ‘ä»¬æ‰‹åŠ¨ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼ˆè¡¨ç¤ºæ˜ å°„çš„æ–‡ä»¶åï¼‰ï¼Œç„¶åå»ºç«‹æ˜ å°„åŒºï¼Œé€šè¿‡æ˜ å°„åŒºçš„é¦–åœ°å€æ¥è¯»å†™ã€‚
æºä»£ç ï¼š

```c
#include<stdio.h>
#include<string.h>
#include<unistd.h>
#include<sys/mman.h>
#include<fcntl.h>

int main(int argc,char* argv[])
{
    if(argc==1)
    {
        printf("argument error\n");
        return -1;
    }
    int fd=open(argv[1],O_RDWR| O_CREAT | O_TRUNC,0644);
    ftruncate(fd,100);
    int len=lseek(fd,0,SEEK_END);
    char* ret=mmap(NULL,len,PROT_READ | PROT_WRITE,MAP_SHARED,fd,0);
    if(ret==MAP_FAILED)
        perror("mmap error");
    char p[100]="This is a test about mmap\n";
    memcpy(ret,p,strlen(p));
    printf("%s",ret);
    close(fd);
    munmap(ret,len);
    return 0;
}    
```

æ•ˆæœï¼š
![2](https://img-blog.csdnimg.cn/direct/089fc266c3d34ad7b1aec110616a987c.png#pic_center)

### æ³¨æ„äº‹é¡¹

1. ç”¨äºåˆ›å»ºæ˜ å°„åŒºçš„æ–‡ä»¶å¤§å°ä¸º 0ï¼Œå®é™…æŒ‡å®šé0å¤§å°åˆ›å»ºæ˜ å°„åŒºï¼Œå‡º â€œæ€»çº¿é”™è¯¯â€ã€‚
2. ç”¨äºåˆ›å»ºæ˜ å°„åŒºçš„æ–‡ä»¶å¤§å°ä¸º 0ï¼Œå®é™…åˆ¶å®š0å¤§å°åˆ›å»ºæ˜ å°„åŒºï¼Œ å‡º â€œæ— æ•ˆå‚æ•°â€ã€‚
3. ç”¨äºåˆ›å»ºæ˜ å°„åŒºçš„æ–‡ä»¶è¯»å†™å±æ€§ä¸ºï¼Œåªè¯»ã€‚æ˜ å°„åŒºå±æ€§ä¸º è¯»ã€å†™ã€‚ å‡º â€œæ— æ•ˆå‚æ•°â€ã€‚
4. åˆ›å»ºæ˜ å°„åŒºï¼Œéœ€è¦readæƒé™ã€‚å½“è®¿é—®æƒé™æŒ‡å®šä¸º â€œå…±äº«â€MAP_SHAREDæ—¶ï¼Œ mmapçš„è¯»å†™æƒé™ï¼Œåº”è¯¥ <=æ–‡ä»¶çš„openæƒé™ã€‚    åªå†™ä¸è¡Œ
5. æ–‡ä»¶æè¿°ç¬¦fdï¼Œåœ¨mmapåˆ›å»ºæ˜ å°„åŒºå®Œæˆå³å¯å…³é—­ã€‚åç»­è®¿é—®æ–‡ä»¶ï¼Œç”¨ åœ°å€è®¿é—®ã€‚
6. offset å¿…é¡»æ˜¯ 4096çš„æ•´æ•°å€ã€‚ï¼ˆMMU æ˜ å°„çš„æœ€å°å•ä½ 4k ï¼‰
7. å¯¹ç”³è¯·çš„æ˜ å°„åŒºå†…å­˜ï¼Œä¸èƒ½è¶Šç•Œè®¿é—®ã€‚ 
8. munmapç”¨äºé‡Šæ”¾çš„ åœ°å€ï¼Œå¿…é¡»æ˜¯mmapç”³è¯·è¿”å›çš„åœ°å€ã€‚
9. æ˜ å°„åŒºè®¿é—®æƒé™ä¸º â€œç§æœ‰â€MAP_PRIVATE, å¯¹å†…å­˜æ‰€åšçš„æ‰€æœ‰ä¿®æ”¹ï¼Œåªåœ¨å†…å­˜æœ‰æ•ˆï¼Œä¸ä¼šååº”åˆ°ç‰©ç†ç£ç›˜ä¸Šã€‚
10. æ˜ å°„åŒºè®¿é—®æƒé™ä¸º â€œç§æœ‰â€MAP_PRIVATE, åªéœ€è¦openæ–‡ä»¶æ—¶ï¼Œæœ‰è¯»æƒé™ï¼Œç”¨äºåˆ›å»ºæ˜ å°„åŒºå³å¯ã€‚ 

### ä¿é™©ç”¨æ³•

1. `fd = openï¼ˆ"æ–‡ä»¶å"ï¼Œ O_RDWRï¼‰;`
2. `mmap(NULL, æœ‰æ•ˆæ–‡ä»¶å¤§å°ï¼Œ PROT_READ|PROT_WRITE, MAP_SHARED, fd, 0);`

### è¿›é˜¶ç»ƒä¹ â€”â€”æ— è¡€ç¼˜å…³ç³»è¿›ç¨‹é—´mmapé€šä¿¡

`mmap_w`éƒ¨åˆ†ï¼š

```c
#include<stdio.h>
#include<unistd.h>
#include<sys/mman.h>
#include<fcntl.h>
#include<string.h>

int main()
{
    int fd=open("mmap_test",O_RDWR|O_TRUNC);
    ftruncate(fd,100);
    int len =lseek(fd,0,SEEK_END);
    char* p=mmap(NULL,len,PROT_READ|PROT_WRITE,MAP_SHARED,fd,0);
    if(p==MAP_FAILED)
        perror("mmap error");
    scanf("%s",p);
    close(fd);
    munmap(p,len);
    return 0;
}
```

`mmap_r`éƒ¨åˆ†ï¼š

```c
#include<stdio.h>
#include<unistd.h>
#include<sys/mman.h>
#include<fcntl.h>
#include<string.h>

int main()
{
    sleep(10);
    int fd=open("mmap_test",O_RDWR);
    int len =lseek(fd,0,SEEK_END);
    char* p=mmap(NULL,len,PROT_READ|PROT_WRITE,MAP_SHARED,fd,0);
    if(p==MAP_FAILED)
        perror("mmap error");
    printf("%s",p);
    close(fd);
    munmap(p,len);
    return 0;
}
```

æ•ˆæœï¼š
![3](https://img-blog.csdnimg.cn/direct/2a279e185e3a4321913dc55313520640.png#pic_center)

### mmapåŒ¿åæ˜ å°„åŒº

åŒ¿åæ˜ å°„ï¼šåªèƒ½ç”¨äº è¡€ç¼˜å…³ç³»è¿›ç¨‹é—´é€šä¿¡ã€‚
    `p = (int *)mmap(NULL, 40, PROT_READ|PROT_WRITE, MAP_SHARED|MAP_ANONYMOUS, -1, 0);`

### æ€»ç»“

1. åˆ›å»ºæ˜ å°„åŒºçš„è¿‡ç¨‹ä¸­ï¼Œéšå«ç€ä¸€æ¬¡å¯¹æ˜ å°„æ–‡ä»¶çš„è¯»æ“ä½œï¼Œæ‰€ä»¥è¦æ±‚æ–‡ä»¶å¿…é¡»æœ‰è¯»çš„æƒé™ã€‚
2. å½“`MAP_SHARED`æ—¶ï¼Œè¦æ±‚ï¼šæ˜ å°„åŒºçš„æƒé™åº”è¯¥`<=`æ–‡ä»¶æ‰“å¼€çš„æƒé™ï¼ˆå‡ºäºå¯¹æ˜ å°„åŒºçš„ä¿æŠ¤ï¼‰ã€‚è€Œ`MAP_PRIVATE`åˆ™æ— æ‰€è°“ï¼Œå› ä¸º`mmap`ä¸­çš„æƒé™æ˜¯å¯¹å†…å­˜çš„é™åˆ¶.
3. æ˜ å°„åŒºçš„é‡Šæ”¾ä¸æ–‡ä»¶å…³é—­æ— å…³ã€‚åªè¦æ˜ å°„å»ºç«‹æˆåŠŸï¼Œæ–‡ä»¶å¯ä»¥ç«‹å³å…³é—­
4. ç‰¹åˆ«æ³¨æ„ï¼Œå½“æ˜ å°„æ–‡ä»¶å¤§å°ä¸º0æ—¶ï¼Œä¸èƒ½åˆ›å»ºæ˜ å°„åŒºã€‚æ‰€ä»¥ï¼šç”¨äºæ˜ å°„çš„æ–‡ä»¶å¿…é¡»è¦æœ‰å®é™…å¤§å°ï¼ï¼`mmap`ä½¿ç”¨æ—¶å¸¸å¸¸ä¼šå‡ºç°æ€»çº¿é”™è¯¯ï¼Œé€šå¸¸æ˜¯ç”±äºå…±äº«æ–‡ä»¶å­˜å‚¨ç©ºé—´å¤§å°å¼•èµ·çš„ã€‚å¦‚ï¼Œ400å­—èŠ‚å¤§å°çš„æ–‡ä»¶ï¼Œåœ¨å»ºç«‹æ˜ å°„åŒºæ—¶ï¼Œ`offset`4096å­—èŠ‚ï¼Œåˆ™ä¼šæŠ¥å‡ºæ€»çº¿é”™è¯¯.
5. `munmap`ä¼ å…¥çš„åœ°å€ä¸€å®šæ˜¯mmapè¿”å›çš„åœ°å€ã€‚åšå†³æœç»æŒ‡é’ˆ++æ“ä½œ,å³`adrr++`.æƒ³è¦æ“ä½œï¼Œå…ˆæ‹·è´ä¸€ä»½ã€‚
6. æ–‡ä»¶åç§»é‡å¿…é¡»ä¸º4Kçš„æ•´æ•°å€ã€‚æ²¡æœ‰ç‰¹æ®Šè¦æ±‚å°±ä¼ `0`.
7. `mmap`åˆ›å»ºæ˜ å°„åŒºå‡ºé”™æ¦‚ç‡éå¸¸é«˜ï¼Œä¸€å®šè¦æ£€æŸ¥è¿”å›å€¼ï¼Œç¡®ä¿æ˜ å°„åŒºå»ºç«‹æˆåŠŸå†è¿›è¡Œåç»­æ“ä½œã€‚

---

## å†™åœ¨æœ€å

ä¸ªäººäº²èº«ç»éªŒï¼šæˆ‘ä»¬å­¦ä¹ çš„ä¸€ç³»åˆ—Linuxå‘½ä»¤ï¼Œä¸€å®šè¦è‡ªå·±**äº²æ‰‹å»æ•²**ã€‚ä¸è¦åªæ˜¯çœ‹åˆ«äººæ•²ä»£ç ï¼Œä¸è¦åªæ˜¯åœç•™åœ¨çœ¼ç›çœ‹ï¼Œè„‘è¢‹ä»¥ä¸ºè‡ªå·±æ‡‚äº†ï¼Œç­‰ä½ å®é™…ä¸Šæ‰‹å»æ•²ä¼šå‘ç°è®¸è®¸å¤šå¤šçš„è¿™æ ·é‚£æ ·çš„é—®é¢˜ã€‚æ­£å¯è°“â€œ**é”®ç›˜æ•²çƒ‚ï¼Œæœˆè–ªè¿‡ä¸‡**â€

---

> å¦‚æœä½ è§‰å¾—æˆ‘å†™çš„é¢˜è§£è¿˜ä¸é”™çš„ï¼Œè¯·å„ä½**ç‹å­å…¬ä¸»**ç§»æ­¥åˆ°æˆ‘çš„å…¶ä»–é¢˜è§£çœ‹çœ‹
> 
> 1. **æ•°æ®ç»“æ„ä¸ç®—æ³•éƒ¨åˆ†ï¼ˆè¿˜åœ¨æ›´æ–°ä¸­ï¼‰ï¼š**
>    - [***C++ STLæ€»ç»“ - åŸºäºç®—æ³•ç«èµ›ï¼ˆå¼ºåŠ›æ¨è***ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/135051716?spm=1001.2014.3001.5501)
>    - [åŠ¨æ€è§„åˆ’â€”â€”å®Œå…¨èƒŒåŒ…é—®é¢˜]([åŠ¨æ€è§„åˆ’â€”â€”å®Œå…¨èƒŒåŒ…é—®é¢˜-CSDNåšå®¢](https://blog.csdn.net/yourgrandfather_/article/details/135111459)[åŠ¨æ€è§„åˆ’â€”â€”å®Œå…¨èƒŒåŒ…é—®é¢˜]([åŠ¨æ€è§„åˆ’â€”â€”å®Œå…¨èƒŒåŒ…é—®é¢˜-CSDNåšå®¢](https://blog.csdn.net/yourgrandfather_/article/details/135111459)
>    - [åŠ¨æ€è§„åˆ’â€”â€”01èƒŒåŒ…é—®é¢˜](https://blog.csdn.net/yourgrandfather_/article/details/135103012?spm=1001.2014.3001.5501)
>    - [åŠ¨æ€è§„åˆ’â€”â€”å¤šé‡èƒŒåŒ…é—®é¢˜](https://blog.csdn.net/yourgrandfather_/article/details/135125267)
>    - [åŠ¨æ€è§„åˆ’â€”â€”åˆ†ç»„èƒŒåŒ…é—®é¢˜](https://blog.csdn.net/yourgrandfather_/article/details/135134277)
>    - [åŠ¨æ€è§„åˆ’â€”â€”æœ€é•¿ä¸Šå‡å­åºåˆ—ï¼ˆLIS)](https://blog.csdn.net/yourgrandfather_/article/details/135150351)
>    - [äºŒå‰æ ‘çš„ä¸­åºéå†ï¼ˆä¸‰ç§æ–¹æ³•ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/135167817)
>    - [æœ€é•¿å›æ–‡å­ä¸²](https://blog.csdn.net/yourgrandfather_/article/details/135183977)
>    - [æœ€çŸ­è·¯ç®—æ³•â€”â€”Dijkstraï¼ˆC++å®ç°ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/134869064?spm=1001.2014.3001.5501)
>    - [æœ€çŸ­è·¯ç®—æ³•â€”â€”â€”Bellman_Fordç®—æ³•ï¼ˆC++å®ç°ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/134935786?spm=1001.2014.3001.5501)
>    - [æœ€çŸ­è·¯ç®—æ³•â€”â€”â€”SPFAç®—æ³•ï¼ˆC++å®ç°ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/135004393?spm=1001.2014.3001.5501)
>    - [æœ€å°ç”Ÿæˆæ ‘ç®—æ³•â€”â€”â€”primç®—æ³•ï¼ˆC++å®ç°ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/135026901?spm=1001.2014.3001.5501)
>    - [æœ€å°ç”Ÿæˆæ ‘ç®—æ³•â€”â€”â€”Kruskalç®—æ³•ï¼ˆC++å®ç°ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/135039904?spm=1001.2014.3001.5501)
>    - [æŸ“è‰²æ³•åˆ¤æ–­äºŒåˆ†å›¾ï¼ˆC++å®ç°ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/135094296?spm=1001.2014.3001.5501)
> 2. **Linuxéƒ¨åˆ†ï¼ˆè¿˜åœ¨æ›´æ–°ä¸­ï¼‰ï¼š**
>    - [Linuxå­¦ä¹ ä¹‹åˆè¯†Linux](https://blog.csdn.net/yourgrandfather_/article/details/134953315?spm=1001.2014.3001.5501)
>    - [Linuxå­¦ä¹ ä¹‹å‘½ä»¤è¡ŒåŸºç¡€æ“ä½œ](https://blog.csdn.net/yourgrandfather_/article/details/134956923?spm=1001.2014.3001.5501)
>    - [Linuxå­¦ä¹ ä¹‹åŸºç¡€å‘½ä»¤ï¼ˆé€‚åˆå°ç™½ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/135189166)
>    - [Linuxå­¦ä¹ ä¹‹æƒé™ç®¡ç†å’Œç”¨æˆ·ç®¡ç†](https://blog.csdn.net/yourgrandfather_/article/details/135222868)
>    - [Linuxå­¦ä¹ ä¹‹åˆ¶ä½œé™æ€åº“å’ŒåŠ¨æ€åº“](https://blog.csdn.net/yourgrandfather_/article/details/135275850)
>    - [Linuxå­¦ä¹ ä¹‹makefile](https://blog.csdn.net/yourgrandfather_/article/details/135288190)
>    - [Linuxå­¦ä¹ ä¹‹ç³»ç»Ÿç¼–ç¨‹1ï¼ˆå…³äºè¯»å†™ç³»ç»Ÿå‡½æ•°ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/135324720)
>    - [Linuxå­¦ä¹ ä¹‹ç³»ç»Ÿç¼–ç¨‹3ï¼ˆè¿›ç¨‹åŠwaitå‡½æ•°ï¼‰](https://blog.csdn.net/yourgrandfather_/article/details/135354402)

## âœ¨ğŸ‰æ€»ç»“

â€œç§ä¸€é¢—æ ‘æœ€å¥½çš„æ˜¯åå¹´å‰,å…¶æ¬¡å°±æ˜¯ç°åœ¨â€
æ‰€ä»¥,
â€œè®©æˆ‘ä»¬ä¸€èµ·åŠªåŠ›å§,å»å¥”èµ´æ›´é«˜æ›´è¿œçš„å±±æµ·â€
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/7bb6bf71a1814bd88fb9615df5cc258d.png#pic_center =400x250)
å¦‚æœæœ‰é”™è¯¯âŒ,æ¬¢è¿æŒ‡æ­£å“ŸğŸ˜‹

ğŸ‰å¦‚æœè§‰å¾—æ”¶è·æ»¡æ»¡,å¯ä»¥åŠ¨åŠ¨å°æ‰‹,ç‚¹ç‚¹èµğŸ‘,æ”¯æŒä¸€ä¸‹å“ŸğŸ‰
